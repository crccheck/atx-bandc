{% extends "base.html" %}

{% block head_title %}City of Austin Boards and Commissions{% endblock %}

{% block extra_style %}
<style>
  .meeting-card li {
    font-size: 0.8rem;
  }

  @media only screen and (max-width: 1000px) {
    .card-columns {
      column-count: 2;
    }
  }

  @media only screen and (max-width: 680px) {
    .card-columns {
      column-count: 1;
    }
  }
</style>
{% endblock %}

{% block content %}
<p>
  Here are lists and RSS feeds for most <a href="https://www.austintexas.gov/department/boards-and-commissions"
    target="_blank">City of Austin Boards and Commissions</a>. The City uses a
  system of PDF documents that can make it hard to browse quickly. This site
  attempts to them into text to make it easy to follow what's happening in Austin.
</p>

<p>
  For City Council meetings, see <a
    href="https://www.austintexas.gov/department/city-council/council-meetings">austintexas.gov/department/city-council/council-meetings</a>
</p>

<p>
  <a href="{% url 'bandc_detail' slug='all' %}">View all documents</a>
  or
  <a href="{% url 'feed' slug='all' %}">
    Subscribe to the RSS feed <i class="fa fa-rss-square" title="rss"></i>
  </a>
</p>

{% if upcoming_meetings %}
  {% include "agenda/includes/upcoming_meetings.html" %}
{% endif %}

<aside class="bg-light p-2 rounded mb-3 text-muted">
  <input type="checkbox" id="show-old-entries">
  <label for="show-old-entries" id="show-old-entries-label" class="mb-0">Show entries older than 1 year</label>
</aside>

<table class="table" id="bandc-table">
  <thead>
    <tr>
      <th>Board or Commission</th>
      <th>Homepage</th>
      <th>Latest Data</th>
      <th>RSS</th>
  </thead>
  <tbody>
    {% for bandc in object_list %}
    <tr>
      <td>
        {% if bandc.latest_meeting %}
        <a href="{{ bandc.get_absolute_url }}">{{ bandc }}</a>
        {% else %}
        {{ bandc }}
        {% endif %}
      </td>
      <td>
        {% if bandc.homepage %}
        <a href="{{ bandc.homepage }}" target="_blank" rel="noopener noreferrer">Homepage
          <i class="fa fa-external-link"></i></a>
        {% endif %}
      </td>
      <td><time datetime="{{ bandc.latest_meeting.date.isoformat }}">{{ bandc.latest_meeting.date.isoformat }}</time></td>
      <td>
        <a href="{% url 'feed' slug=bandc.slug %}"><i class="fa fa-rss-square" title="rss"></i></a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}

{% block extra_script %}
<script>
(function() {
  const checkbox = document.getElementById('show-old-entries');
  const label = document.getElementById('show-old-entries-label');
  const table = document.getElementById('bandc-table');
  const oneYearAgo = new Date();
  oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);

  let oldCount = 0;
  table.querySelectorAll('tbody tr').forEach(row => {
    const time = row.querySelector('time');
    const isOld = !time || !time.dateTime || new Date(time.dateTime) < oneYearAgo;
    if (isOld) oldCount++;
  });

  label.textContent = `Show ${oldCount} entries older than 1 year`;

  function updateVisibility() {
    const showOld = checkbox.checked;
    table.querySelectorAll('tbody tr').forEach(row => {
      const time = row.querySelector('time');
      if (!time || !time.dateTime) {
        row.hidden = !showOld;
        return;
      }
      const date = new Date(time.dateTime);
      row.hidden = !showOld && date < oneYearAgo;
    });
  }

  checkbox.addEventListener('change', updateVisibility);
  updateVisibility();
})();
</script>
{% endblock %}
